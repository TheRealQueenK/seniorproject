<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RateNCAT</title>
    <link rel="icon" href="../images/RateNCAT.png">
    <link rel="stylesheet" href="../css/bootstrap.css">
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
        <link rel="stylesheet" type="text/css" href="./style.css" />
        <script src="./index.js"></script>

        <style type="text/css">
            #map {
                height: 500px;
                width: 80%;
            }

            #panel {
                height: 100%;
                width: null;
                background-color: white;
                position: fixed;
                z-index: 1;
                overflow-x: hidden;
                transition: all .2s ease-out;
            }

            .open {
                width: 250px;
            }

            .hero {
                width: 100%;
                height: auto;
                max-height: 166px;
                display: block;
            }

            .place,
            p {
                font-family: 'open sans', Arial, sans-serif;
                padding-left: 18px;
                padding-right: 18px;
            }

            .details {
                color: darkslategrey;
            }

            a {
                text-decoration: none;
                color: cadetblue;
            }
        </style>
</head>
<body>
<header>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #00008B;">
        <div class="container">
            <a class="navbar-brand" href="../homepage/home.html">
                <img src="../images/RateNCAT.png" alt="" width="35" height="35">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="../homepage/home.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../p&f/p&f.html">Rate Professors/Faculty</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../facilities/facilities.html">Rate Facilities</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="r&s.html">Rate Restaurants/Stores</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../improvements/user-rating-with-review-system-in-php-mysql-using-ajax/improvements.php">Improvements for University</a>
                    </li>
                    <li class="nav-item px-5">
                        <a class="nav-link" href="../index.html">Sign Out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<main class="my-5">
    <div class="container">
        <div class="row">
            <div class="col-md-7">
                <img src="../images/bulldogDoggie.png" alt="" class="img-fluid">
            </div>
            <div class="col-md-5">
                <h1>Restaurants & Stores</h1>
                <p class="mt-4">
                    Welcome to the Restaurants and Stores section of RateNCAT. In
                    this section, you are able to view the restaurants and stores
                    within a 10-mile radius of campus, as well as rate the on-campus
                    dining options out of 5 stars and leave a review under
                    your star rating.
                </p>
            </div>
        </div>

        <br>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaNu3hWzsJE0MAP6CfOWpz1z5nXRhs5hA&callback=initMap&libraries=places&v=weekly">
        </script>

        <div id="panel"></div>
        <div id="map"></div>

        <script>
            let ncat;
            let map;
            let bounds;
            let infoWindow;
            let currentInfoWindow;
            let service;
            let infoPane;

            function initMap() {
                bounds = new google.maps.LatLngBounds();
                infoWindow = new google.maps.InfoWindow;
                currentInfoWindow = infoWindow;
                infoPane = document.getElementById('panel');

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(position => {
                        ncat = {lat: 36.075258, lng: -79.772205};
                        map = new google.maps.Map(document.getElementById("map"), {
                            center: ncat,
                            zoom: 150
                        });
                        bounds.extend(ncat);

                        infoWindow.setPosition(ncat);
                        infoWindow.setContent('Location found.');
                        infoWindow.open(map);
                        map.setCenter(ncat);

                        getNearbyPlaces(ncat);
                    }, () => {
                        handleLocationError(true, infoWindow);
                    });
                } else {
                    handleLocationError(false, infoWindow);
                }
            }

            function handleLocationError(browserHasGeolocation, infoWindow) {
                ncat = {lat: 36.075258, lng: -79.772205};
                map = new google.maps.Map(document.getElementById('map'), {
                    center: ncat,
                    zoom: 150
                });

                infoWindow.setPosition(ncat);
                infoWindow.setContent(browserHasGeolocation ?
                    'Geolocation permissions denied. Using default location.' :
                    'Error: Your browser doesn\'t support geolocation.');
                infoWindow.open(map);
                currentInfoWindow = infoWindow;

                getNearbyPlaces(ncat);
            }

            function getNearbyPlaces(position) {
                let request = {
                    location: position,
                    rankBy: google.maps.places.RankBy.DISTANCE,
                    keyword: 'restaurant',
                    keyword: 'store',
                    keyword: 'food',
                };

                service = new google.maps.places.PlacesService(map);
                service.nearbySearch(request, nearbyCallback);
            }

            function nearbyCallback(results, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                    createMarkers(results);
                }
            }

            function createMarkers(places) {
                places.forEach(place => {
                    let marker = new google.maps.Marker({
                        position: place.geometry.location,
                        map: map,
                        title: place.name
                    });

                    google.maps.event.addListener(marker, 'click', () => {
                        let request = {
                            placeId: place.place_id,
                            fields: ['name', 'formatted_address', 'geometry', 'rating',
                                'website', 'photos']
                        };

                        service.getDetails(request, (placeResult, status) => {
                            showDetails(placeResult, marker, status)
                        });
                    });

                    bounds.extend(place.geometry.location);
                });

                map.fitBounds(bounds);

                function showDetails(placeResult, marker, status) {
                    if (status == google.maps.places.PlacesServiceStatus.OK) {
                        let placeInfowindow = new google.maps.InfoWindow();
                        placeInfowindow.setContent('<div><strong>' + placeResult.name +
                            '</strong><br>' + 'Rating: ' + placeResult.rating + '</div>');
                        placeInfowindow.open(marker.map, marker);
                        currentInfoWindow.close();
                        currentInfoWindow = placeInfowindow;
                        showPanel(placeResult);
                    } else {
                        console.log('showDetails failed: ' + status);
                    }
                }

                // function showPanel(placeResult) {
                //     if (infoPane.classList.contains("open")) {
                //         infoPane.classList.remove("open");
                //     }
                //
                //     while (infoPane.lastChild) {
                //         infoPane.removeChild(infoPane.lastChild);
                //     }
                //
                //     if (placeResult.photos != null) {
                //         let firstPhoto = placeResult.photos[0];
                //         let photo = document.createElement('img');
                //         photo.classList.add('hero');
                //         photo.src = firstPhoto.getUrl();
                //         infoPane.appendChild(photo);
                //     }
                //
                //     let name = document.createElement('h1');
                //     name.classList.add('place');
                //     name.textContent = placeResult.name;
                //     infoPane.appendChild(name);
                //     if (placeResult.rating != null) {
                //         let rating = document.createElement('p');
                //         rating.classList.add('details');
                //         rating.textContent = 'Rating: ${placeResult.rating} \u272e';
                //         infoPane.appendChild(rating);
                //     }
                //     let address = document.createElement('p');
                //     address.classList.add('details');
                //     address.textContent = placeResult.formatted_address;
                //     infoPane.appendChild(address);
                //     if (placeResult.website) {
                //         let websitePara = document.createElement('p');
                //         let websiteLink = document.createElement('a');
                //         let websiteUrl = document.createTextNode(placeResult.website);
                //         websiteLink.appendChild(websiteUrl);
                //         websiteLink.title = placeResult.website;
                //         websiteLink.href = placeResult.website;
                //         websitePara.appendChild(websiteLink);
                //         infoPane.appendChild(websitePara);
                //     }
                //
                //     infoPane.classList.add("open");
                // }
            }
        </script>

        <br>
        <div class="card text-center">
            <h5 class="card-header">Aggie Dining</h5>
            <div class="row">
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Williams Dining Hall</h5>
                            <br>
                            <a href="WilliamsDining/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">The Marketplace</h5>
                            <br>
                            <a href="TheMarketplace/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">QDOBA Mexican Eats</h5>
                            <br>
                            <a href="QDOBA/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Starbucks</h5>
                            <br>
                            <a href="Starbucks/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">McAlisters Deli</h5>
                            <br>
                            <a href="McAlistersDeli/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Paavo's Pizza</h5>
                            <br>
                            <a href="PaavosPizza/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Aggie Wings & Cafe</h5>
                            <br>
                            <a href="AggieWings/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">1891 Revolution</h5>
                            <br>
                            <a href="1891Revolution/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Chick-fil-A</h5>
                            <br>
                            <a href="ChickfilA/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Einstein Bros. Bagels</h5>
                            <br>
                            <a href="EinsteinBrosBagels/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Sub Connection</h5>
                            <br>
                            <a href="SubConnection/user-rating-with-review-system-in-php-mysql-using-ajax/rating.php" class="btn btn-primary">Rate Now!</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>
<script src="../js/bootstrap.bundle.js"></script>
</body>
</html>
